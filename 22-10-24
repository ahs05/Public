# Function to retrieve dynamic device collections whose names contain "discovery"
function Get-DynamicCollections {
    param (
        [string]$ComputerName
    )

    try {
        # Retrieve all collections and filter only those with "discovery" in the name
        $collections = Get-CMDeviceCollection | Where-Object {
            $_.Name -match "discovery"
        }

        # Filter only collections that have query-based membership rules
        $dynamicCollections = @()
        foreach ($collection in $collections) {
            # Check if the collection has a query-based membership rule
            $queryRule = Get-CMDeviceCollectionQueryMembershipRule -CollectionId $collection.CollectionID -ErrorAction SilentlyContinue
            if ($queryRule) {
                $dynamicCollections += $collection
            }
        }

        return $dynamicCollections
    } catch {
        Write-Warning "Failed to retrieve dynamic collections - $_"
        return $null
    }
}
