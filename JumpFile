$CCMClient = Get-WmiObject -Namespace "root\ccm" -Class "SMS_Client"
$Collections = Invoke-CimMethod -Namespace "root\ccm" -ClassName "SMS_Client" -MethodName "GetAssignedUserCollections"

Windows Registry Editor Version 5.00

[HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\WindowsCopilot]
"TurnOffWindowsCopilot"=dword:00000001

[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsCopilot]
"TurnOffWindowsCopilot"=dword:00000001

[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Edge]
"HubsSidebarEnabled"=dword:00000000

[HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Explorer]
"DisableSearchBoxSuggestions"=dword:00000001

[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\Explorer]
"DisableSearchBoxSuggestions"=dword:00000001
---------------------------------------------------
Defender Error Fix: https://www.windows11forums.com/threads/windows-11-defender-firewall-will-not-load.355/#post-3757
Defender Error Fix: https://techlou.com/fix-unable-to-delete-all-specified-values-error-in-registry-editor/
https://windowsforum.com/threads/win11-upgrade-2025-07-cu-causing-mpssvc-break.375192/
---------------------------------------------------
/* FULL USER ↔ DEVICE MAPPING REPORT
   Combines:
   - Logon-based mappings (v_UserMachineRelation)
   - UDA primary device relationships (v_UserMachineRelationship)
*/

SELECT DISTINCT
    usr.Unique_User_Name0           AS [UserName],
    usr.Full_User_Name0             AS [FullName],
    usr.Windows_NT_Domain0          AS [Domain],
    coll.CollectionName             AS [Collection],

    /* Device Info */
    dev.Name0                       AS [DeviceName],
    dev.Client0                     AS [ClientInstalled],
    dev.Active0                     AS [ClientActive],
    dev.LastLogonTimestamp0         AS [DeviceLastLogon],

    /* Logon-based Relation */
    rel.RelationActive              AS [LogonRelationActive],
    rel.CreationTime                AS [LogonRelationCreated],
    rel.InactivationTime            AS [LogonRelationInactive],

    /* UDA Relationship */
    CASE WHEN uda.IsPrimaryUser = 1 THEN 1 ELSE 0 END 
                                    AS [UDAPrimary],
    uda.SourceType                  AS [UDASource],
    uda.CreationTime                AS [UDACreated],
    uda.IsActive                    AS [UDAActive],

    /* Final Classification */
    CASE
        WHEN dev.Name0 IS NULL THEN 'NO DEVICE FOUND'
        WHEN uda.IsPrimaryUser = 1 THEN 'UDA PRIMARY DEVICE'
        WHEN rel.RelationActive = 1 THEN 'ACTIVE LOGON DEVICE'
        WHEN rel.RelationActive = 0 THEN 'INACTIVE LOGON RELATION'
        WHEN dev.Client0 = 0 THEN 'DEVICE HAS NO SCCM CLIENT'
        ELSE 'OTHER DEVICE'
    END AS [Status]

FROM v_FullCollectionMembership colm
INNER JOIN v_R_User usr
    ON colm.ResourceID = usr.ResourceID
INNER JOIN v_Collection coll
    ON colm.CollectionID = coll.CollectionID

/* Logon-based User ↔ Device mapping */
LEFT JOIN v_UserMachineRelation rel
    ON usr.Unique_User_Name0 = rel.UniqueUserName

/* UDA (Primary Device) relationship */
LEFT JOIN v_UserMachineRelationship uda
    ON usr.ResourceID = uda.UserResourceID

/* Device details joined via MachineResourceID */
LEFT JOIN v_R_System dev
    ON (
           dev.ResourceID = rel.MachineResourceID
        OR dev.ResourceID = uda.MachineResourceID
       )

WHERE
    colm.CollectionID = 'XYZ-COLLECTIONID'

ORDER BY usr.Unique_User_Name0, dev.Name0;

---------------------------

Here’s a clean, professional reply you can send to the Microsoft rep, aligned with the prior Zscaler FW/AV context and remediation work:

---

Hi **[Name]**,

Thank you for sharing the script and supporting us through this issue.

We wanted to confirm that the PowerShell script you provided appears to be working as expected. After deploying it via Intune as a Proactive Remediation, we are seeing the previously reported Zscaler Firewall/AV issues getting resolved on affected devices. Based on our current observations and validation, we are comfortable confirming that the issue is mitigated and you may proceed with closing the ticket.

Should we have any follow-up questions related to this same topic, please let us know if you would prefer that we respond directly to this email thread, or if you would like us to open a new support ticket and reference this existing case.

Thanks again for your assistance and continued support.

Best regards,
**[Your Name]**
**[Your Title / Team]**
**[Company Name]**

---

If you want a slightly more **formal** or **more concise** version, I can tailor it quickly.


