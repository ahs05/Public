$CCMClient = Get-WmiObject -Namespace "root\ccm" -Class "SMS_Client"
$Collections = Invoke-CimMethod -Namespace "root\ccm" -ClassName "SMS_Client" -MethodName "GetAssignedUserCollections"

Windows Registry Editor Version 5.00

[HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\WindowsCopilot]
"TurnOffWindowsCopilot"=dword:00000001

[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsCopilot]
"TurnOffWindowsCopilot"=dword:00000001

[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Edge]
"HubsSidebarEnabled"=dword:00000000

[HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Explorer]
"DisableSearchBoxSuggestions"=dword:00000001

[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\Explorer]
"DisableSearchBoxSuggestions"=dword:00000001
---------------------------------------------------
Defender Error Fix: https://www.windows11forums.com/threads/windows-11-defender-firewall-will-not-load.355/#post-3757
Defender Error Fix: https://techlou.com/fix-unable-to-delete-all-specified-values-error-in-registry-editor/
https://windowsforum.com/threads/win11-upgrade-2025-07-cu-causing-mpssvc-break.375192/
---------------------------------------------------
/* FULL USER ↔ DEVICE MAPPING REPORT
   Combines:
   - Logon-based mappings (v_UserMachineRelation)
   - UDA primary device relationships (v_UserMachineRelationship)
*/

SELECT DISTINCT
    usr.Unique_User_Name0           AS [UserName],
    usr.Full_User_Name0             AS [FullName],
    usr.Windows_NT_Domain0          AS [Domain],
    coll.CollectionName             AS [Collection],

    /* Device Info */
    dev.Name0                       AS [DeviceName],
    dev.Client0                     AS [ClientInstalled],
    dev.Active0                     AS [ClientActive],
    dev.LastLogonTimestamp0         AS [DeviceLastLogon],

    /* Logon-based Relation */
    rel.RelationActive              AS [LogonRelationActive],
    rel.CreationTime                AS [LogonRelationCreated],
    rel.InactivationTime            AS [LogonRelationInactive],

    /* UDA Relationship */
    CASE WHEN uda.IsPrimaryUser = 1 THEN 1 ELSE 0 END 
                                    AS [UDAPrimary],
    uda.SourceType                  AS [UDASource],
    uda.CreationTime                AS [UDACreated],
    uda.IsActive                    AS [UDAActive],

    /* Final Classification */
    CASE
        WHEN dev.Name0 IS NULL THEN 'NO DEVICE FOUND'
        WHEN uda.IsPrimaryUser = 1 THEN 'UDA PRIMARY DEVICE'
        WHEN rel.RelationActive = 1 THEN 'ACTIVE LOGON DEVICE'
        WHEN rel.RelationActive = 0 THEN 'INACTIVE LOGON RELATION'
        WHEN dev.Client0 = 0 THEN 'DEVICE HAS NO SCCM CLIENT'
        ELSE 'OTHER DEVICE'
    END AS [Status]

FROM v_FullCollectionMembership colm
INNER JOIN v_R_User usr
    ON colm.ResourceID = usr.ResourceID
INNER JOIN v_Collection coll
    ON colm.CollectionID = coll.CollectionID

/* Logon-based User ↔ Device mapping */
LEFT JOIN v_UserMachineRelation rel
    ON usr.Unique_User_Name0 = rel.UniqueUserName

/* UDA (Primary Device) relationship */
LEFT JOIN v_UserMachineRelationship uda
    ON usr.ResourceID = uda.UserResourceID

/* Device details joined via MachineResourceID */
LEFT JOIN v_R_System dev
    ON (
           dev.ResourceID = rel.MachineResourceID
        OR dev.ResourceID = uda.MachineResourceID
       )

WHERE
    colm.CollectionID = 'XYZ-COLLECTIONID'

ORDER BY usr.Unique_User_Name0, dev.Name0;

---------------------------

# ----------------------------------------
Here’s a clean, professional email you can send to your team. I’ve filled in gaps and tightened the language while keeping your intent clear:

---

**Subject:** Update: Zscaler FW/AV Issue – Intune Proactive Remediation Deployment

Hi Team,

I wanted to provide an update on the Zscaler FW/AV issue we’ve been troubleshooting.

Long story short, Microsoft has now provided us with a PowerShell script to address the problem. Based on this, I’ve created an **Intune Proactive Remediation** package to remediate the issue on affected devices.

**Key points to note:**

* The remediation script is fully configured in Intune.
* This solution **must be delivered via Intune only**, as the impacted devices are:

  * Off the corporate network
  * Unable to connect to VPN
  * Connected only to the internet
    Given these constraints, Intune is currently the **only viable deployment mechanism**.

I’ve attached:

* A screenshot of the Proactive Remediation configuration
* A screenshot showing how the Proactive Remediation is applied via Intune

I understand that not all team members currently have **Intune Admin console access**. Until the required access is provisioned, please coordinate and work closely with team members who already have console access to ensure smooth execution and monitoring.

If you have any questions or notice any anomalies during deployment or remediation results, please raise them so we can address them quickly.

Thanks everyone for the continued collaboration on this.

Best regards,
**[Your Name]**

