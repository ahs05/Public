 https://www.kb.ischool.uw.edu/2022/02/04/set-up-ischool-issued-windows-computer/

https://www.bleepingcomputer.com/news/microsoft/microsoft-fixes-print-to-pdf-feature-broken-by-windows-update/

https://www.catalog.update.microsoft.com/Search.aspx?q=KB5060829

S
---------------------------------------------------
Start of Script
---------------------------------------
Refer all these Articles for Clean up Hard Drive (C:\): 

https://prosystech.nl/powershell-clean-up-hard-drive-c/
https://level.io/library/script-windows-disk-cleanup
https://roheed.com/free-up-disk-space-using-powershell/
https://darwinsdata.com/how-do-i-run-a-disk-cleanup-in-powershell/
https://www.geeksforgeeks.org/linux-unix/disk-cleanup-using-powershell-scripts/(Less intrusive Way)

Defender Error Fix: https://www.windows11forums.com/threads/windows-11-defender-firewall-will-not-load.355/#post-3757
Defender Error Fix: https://techlou.com/fix-unable-to-delete-all-specified-values-error-in-registry-editor/
https://windowsforum.com/threads/win11-upgrade-2025-07-cu-causing-mpssvc-break.375192/
---------------------------------------------------

# Define the registry key path
$RegPath = "HKLM:\SOFTWARE\7-Zip\Hari"

# Get the current ACL of the registry key
$acl = Get-Acl -Path $RegPath

# Create a new access rule
# BUILTIN\Users = all local users
# BUILTIN\Administrators = Local admins group
# NT AUTHORITY\Authenticated Users = All authenticated users (domain or local)
# FullControl = full rights
# ContainerInherit, ObjectInherit = apply to subkeys
# None = no special propagation flags
# Allow = grant permissions
$rule = New-Object System.Security.AccessControl.RegistryAccessRule(
    "BUILTIN\Users",
    "FullControl",
    "ContainerInherit,ObjectInherit",
    "None",
    "Allow"
)

# Add the rule to the ACL
$acl.SetAccessRule($rule)

# Apply the ACL back to the registry key
Set-Acl -Path $RegPath -AclObject $acl


---------

# Define the registry key path
$RegPath = "HKLM:\SYSTEM\CurrentControlSet\Services\mpssvc\Parameters\AppCs"

# Step 1: Take ownership
$owner = [System.Security.Principal.NTAccount]"BUILTIN\Administrators"
$acl = Get-Acl -Path $RegPath
$acl.SetOwner($owner)
Set-Acl -Path $RegPath -AclObject $acl

# Step 2: Add full control for Authenticated Users
$acl = Get-Acl -Path $RegPath
$rule = New-Object System.Security.AccessControl.RegistryAccessRule(
    "NT AUTHORITY\Authenticated Users",
    "FullControl",
    "ContainerInherit,ObjectInherit",
    "None",
    "Allow"
)
$acl.SetAccessRule($rule)
Set-Acl -Path $RegPath -AclObject $acl

# Step 3 (Optional): Restore ownership to the service account
# (This keeps Windows happy and avoids service issues)
$svcOwner = New-Object System.Security.Principal.NTAccount("NT SERVICE\MpsSvc")
$acl = Get-Acl -Path $RegPath
$acl.SetOwner($svcOwner)
Set-Acl -Path $RegPath -AclObject $acl


---------------------------


# Define the registry key path
$RegPath = "HKLM:\SYSTEM\CurrentControlSet\Services\mpssvc\Parameters\AppCs"

# --- Step 0: Force .NET RegistryKey object (sometimes Get-Acl fails directly) ---
$regKey = [Microsoft.Win32.Registry]::LocalMachine.OpenSubKey(
    "SYSTEM\CurrentControlSet\Services\mpssvc\Parameters\AppCs",
    [Microsoft.Win32.RegistryKeyPermissionCheck]::ReadWriteSubTree,
    [System.Security.AccessControl.RegistryRights]::TakeOwnership
)

if (-not $regKey) {
    Write-Error "Failed to open registry key: $RegPath"
    exit
}

# --- Step 1: Take ownership ---
$acl = $regKey.GetAccessControl([System.Security.AccessControl.AccessControlSections]::All)
$owner = [System.Security.Principal.NTAccount]"BUILTIN\Administrators"
$acl.SetOwner($owner)
$regKey.SetAccessControl($acl)

# --- Step 2: Add full control for Authenticated Users ---
$acl = $regKey.GetAccessControl()
$rule = New-Object System.Security.AccessControl.RegistryAccessRule(
    "NT AUTHORITY\Authenticated Users",
    [System.Security.AccessControl.RegistryRights]::FullControl,
    [System.Security.AccessControl.InheritanceFlags]::ContainerInherit -bor [System.Security.AccessControl.InheritanceFlags]::ObjectInherit,
    [System.Security.AccessControl.PropagationFlags]::None,
    [System.Security.AccessControl.AccessControlType]::Allow
)
$acl.SetAccessRule($rule)
$regKey.SetAccessControl($acl)

# --- Step 3 (Optional): Restore ownership back to MpsSvc ---
$acl = $regKey.GetAccessControl()
$svcOwner = New-Object System.Security.Principal.NTAccount("NT SERVICE\MpsSvc")
$acl.SetOwner($svcOwner)
$regKey.SetAccessControl($acl)

$regKey.Close()

----------------------------
#4
$tok = [System.Security.Principal.WindowsIdentity]::GetCurrent().Token
$SE_TAKE_OWNERSHIP = 0x14
$null = [advapi32]::AdjustTokenPrivileges($tok, $false, [PSCustomObject]@{PrivilegeCount=1; Luid=$SE_TAKE_OWNERSHIP; Attributes=2}, 0, [IntPtr]::Zero, [IntPtr]::Zero)
Write-Host "SeTakeOwnershipPrivilege enabled for this session."

------------------------
#5
# Step 1: Define the registry key path
$RegPath = "HKLM:\SYSTEM\CurrentControlSet\Services\mpssvc\Parameters\AppCs"

# Step 2: Open the registry key with ReadWrite permissions
$RegKey = [Microsoft.Win32.Registry]::LocalMachine.OpenSubKey(
    "SYSTEM\CurrentControlSet\Services\mpssvc\Parameters\AppCs", 
    [Microsoft.Win32.RegistryKeyPermissionCheck]::ReadWriteSubTree, 
    [System.Security.AccessControl.RegistryRights]::ChangePermissions
)

# Step 3: Get the current ACL
$acl = $RegKey.GetAccessControl()

# Step 4: Set the owner to Administrators (or your current user)
$owner = [System.Security.Principal.NTAccount]"Administrators"
$acl.SetOwner($owner)

# Step 5: Apply the new ACL
$RegKey.SetAccessControl($acl)

# Step 6: Grant FullControl to Administrators
$rule = New-Object System.Security.AccessControl.RegistryAccessRule (
    "Administrators", "FullControl", "ContainerInherit,ObjectInherit", "None", "Allow"
)
$acl.AddAccessRule($rule)
$RegKey.SetAccessControl($acl)

$RegKey.Close()

Write-Host "Ownership and full control granted. You can now modify the key."

--------------

#Export 
$HiveRoot = "HKLM\SYSTEM\CurrentControlSet\Services\mpssvc\Parameters\AppCs"
$OutFile = "C:\Temp\Appcs.hiv"
Start-Process -FilePath reg -ArgumentList "save `"$HiveRoot`" `"$OutFile`"" -Wait -NoNewWindow
Write-Host "Saved $HiveRoot to $OutFile"

-----------
#Import

# Path to your hive file
$HiveFile = "C:\Users\hkaka\Downloads\firewall_fix_windows_11\mpssvc.hiv"

# Mount location under HKEY_LOCAL_MACHINE (can also use HKEY_USERS)
$MountPoint = "TempHive"

# Load the hive
reg load "HKLM\$MountPoint" $HiveFile
Write-Host "Hive loaded at HKLM:\$MountPoint"
---------------
https://www.systemcenterdudes.com/deploy-windows-10-extended-security-update-key-with-intune-or-sccm/

---

Absolutely ‚Äî here‚Äôs the refined version with that final paragraph adjusted to reflect the team‚Äôs current Mac management knowledge in a diplomatic tone:

---
Excellent ‚Äî since you‚Äôre a **senior Intune/SCCM/MEM admin and OSD/endpoint management specialist**, here‚Äôs a detailed breakdown of what **Intune and Azure permissions** you‚Äôll need for full day-to-day operational capability without requiring Global Admin.

---

### üß≠ Core Objective

Enable you to:

* Manage devices, compliance, and configurations
* Deploy and troubleshoot apps
* Manage enrollment and policies
* Integrate with SCCM, AAD, and Autopilot
* Perform reporting and advanced troubleshooting
  ‚Äîall without tenant-wide or security-critical privileges.

---

## 1. **Microsoft Intune Permissions**

### **A. Roles in Intune (Endpoint Manager)**

Your Azure admin can create a **custom Intune role** (or assign existing ones like *Intune Administrator* or *Endpoint Security Manager*) containing these permission sets:

| **Category**                    | **Key Permissions You Need**                                                                   | **Purpose / Day-to-Day Use**                                  |
| ------------------------------- | ---------------------------------------------------------------------------------------------- | ------------------------------------------------------------- |
| **Device Management**           | - Read/Write Devices<br>- Remote Lock, Wipe, Retire, Sync<br>- Restart, BitLocker key rotation | Manage and support enrolled Windows/iOS/macOS/Android devices |
| **Compliance Policies**         | - Create/Read/Update/Delete Compliance Policies                                                | Enforce device compliance baselines                           |
| **Configuration Profiles**      | - Create/Modify/Delete/Assign Configuration Profiles                                           | Push Wi-Fi, VPN, Certificates, and Custom CSP policies        |
| **Scripts & Automation**        | - Create/Read/Assign PowerShell scripts and Remediation Scripts                                | Deploy and monitor custom PS scripts and remediations         |
| **App Management**              | - Create/Modify/Delete/Assign Applications                                                     | Add Win32, LOB, and Store apps; manage deployment rings       |
| **Enrollment**                  | - Manage Autopilot Devices and Profiles<br>- Read/Write Enrollment Restrictions                | Enroll and configure devices through Windows Autopilot        |
| **Endpoint Security**           | - Create/Modify/Delete Security Baselines<br>- Manage AV/Firewall/BitLocker Policies           | Implement Defender and BitLocker management                   |
| **Reporting & Troubleshooting** | - Read Device and User Reports<br>- Device Diagnostics                                         | Analyze compliance and deployment results                     |
| **Remote Tasks**                | - Restart, Sync, Wipe, Reset passcode                                                          | Day-to-day support actions for users                          |

---

## 2. **Azure AD (Entra ID) Permissions**

Since Intune heavily relies on Entra (Azure AD), the Global Admin can create a **custom Azure AD role** with these delegated permissions:

| **Area**                                 | **Permission Name**                                                     | **Why You Need It**                                         |
| ---------------------------------------- | ----------------------------------------------------------------------- | ----------------------------------------------------------- |
| **Device Objects**                       | - Read/Write Devices<br>- Join devices to AAD<br>- Manage device owners | To view and manage hybrid-joined / Autopilot devices        |
| **Group Management**                     | - Read/Write Groups (Security + M365)<br>- Assign Dynamic Rules         | For targeting deployments and policies                      |
| **User Read**                            | - Directory.Read.All                                                    | To view users for targeting and troubleshooting             |
| **Role Assignments (Optional)**          | - Read Directory Roles                                                  | To check your access levels for troubleshooting             |
| **Application Registrations (Optional)** | - Read/Write App Registrations                                          | For integration scripts and automation tools like Graph API |
| **Autopilot Device Import (Graph API)**  | - DeviceManagementServiceConfig.ReadWrite.All                           | Needed if you import Autopilot hardware hashes via Graph    |

---

## 3. **SCCM / Co-management Integration (Optional)**

If your org uses MECM (SCCM) with Intune co-management:

* Ensure your account has **Full Administrator** in SCCM or **custom RBAC** with:

  * Device Collections read/write
  * Application/Package Deployment
  * Task Sequence and OS Image management
  * Client Notification and Endpoint Protection permissions

---

## 4. **Additional Graph API / Automation Needs**

If you use PowerShell or automation:
You‚Äôll need **API permissions** (either via delegated or service principal) for:

* `DeviceManagementApps.ReadWrite.All`
* `DeviceManagementConfiguration.ReadWrite.All`
* `DeviceManagementManagedDevices.ReadWrite.All`
* `Directory.Read.All`

---

## ‚úÖ Recommended Role Setup

### Option 1: Use Built-in Roles

Assign **Intune Administrator** (or **Endpoint Security Manager**) + **Intune Reader** as base access.
Then add **custom Azure AD role** with:

* `Device.ReadWrite.All`
* `Group.ReadWrite.All`
* `Directory.Read.All`
* `DeviceManagementConfiguration.ReadWrite.All`

### Option 2: Custom Role Combination (Best Practice)

Create a **custom Entra role** named:

> ‚ÄúEndpoint & Device Management Admin (Custom)‚Äù

Include the above permissions and assign via **Privileged Identity Management (PIM)** for security.

---

Would you like me to **generate a ready-to-share permission list JSON (for Azure custom role creation)** that your Global Admin can directly import in Azure AD?
That would make it easy for him to provision it cleanly.

